{% extends 'base.html' %}

{% block title %}Reservations - Ulendo Reservation System{% endblock %}

{% block page_title %}All Reservations{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Search Reservations</h3>
    </div>
    <div class="card-body">
        <form method="get" class="grid grid-2">
            <div class="form-group">
                <label class="form-label">Customer Name</label>
                <input type="text" name="name" value="{{ search_name }}" class="form-control" placeholder="Search by name...">
            </div>
            <div class="form-group">
                <label class="form-label">Voucher Number</label>
                <input type="text" name="voucher" value="{{ search_voucher }}" class="form-control" placeholder="Search by voucher...">
            </div>
            <div class="form-group">
                <label class="form-label">Check-in From</label>
                <input type="date" name="start_date" value="{{ start_date }}" class="form-control">
            </div>
            <div class="form-group">
                <label class="form-label">Check-out To</label>
                <input type="date" name="end_date" value="{{ end_date }}" class="form-control">
            </div>
            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary">Search</button>
                <a href="{% url 'reservations:reservation_list' %}" class="btn btn-secondary">Clear</a>
            </div>
        </form>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h3 class="card-title">Reservations ({{ page_obj.paginator.count }} total)</h3>
    </div>
    <div class="card-body">
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Customer</th>
                        <th>Room</th>
                        <th>Check-in</th>
                        <th>Check-out</th>
                        <th>Voucher</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for reservation in page_obj %}
                    <tr>
                        <td><strong>{{ reservation.customer_name }}</strong></td>
                        <td>Room {{ reservation.room.room_number }}</td>
                        <td>{{ reservation.check_in_date|date:"M d, Y" }}</td>
                        <td>{{ reservation.check_out_date|date:"M d, Y" }}</td>
                        <td>{{ reservation.voucher_number|default:"â€”" }}</td>
                        <td>
                            {% if reservation.status == 'confirmed' %}
                            <span class="badge badge-success">Confirmed</span>
                            {% else %}
                            <span class="badge badge-error">Cancelled</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="d-flex gap-1">
                                {% if reservation.status == 'confirmed' %}
                                <a href="{% url 'reservations:cancel_reservation' reservation.pk %}" class="btn btn-sm btn-danger">Cancel</a>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                            No reservations found.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {% if page_obj.has_other_pages %}
        <div class="d-flex justify-between align-center mt-3">
            <div>
                Showing {{ page_obj.start_index }} to {{ page_obj.end_index }} of {{ page_obj.paginator.count }} reservations
            </div>
            <div class="d-flex gap-1">
                {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}{% if search_name %}&name={{ search_name }}{% endif %}{% if search_voucher %}&voucher={{ search_voucher }}{% endif %}{% if start_date %}&start_date={{ start_date }}{% endif %}{% if end_date %}&end_date={{ end_date }}{% endif %}" class="btn btn-sm btn-outline">Previous</a>
                {% endif %}
                <span class="btn btn-sm" style="background: var(--background);">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
                {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}{% if search_name %}&name={{ search_name }}{% endif %}{% if search_voucher %}&voucher={{ search_voucher }}{% endif %}{% if start_date %}&start_date={{ start_date }}{% endif %}{% if end_date %}&end_date={{ end_date }}{% endif %}" class="btn btn-sm btn-outline">Next</a>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
